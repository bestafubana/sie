<h1>Levantamentos</h1>

<script>
    $(document).ready(function() {
        $('li[accesskey|="3"]').addClass("current_page_item");
    });
    
    function gerarRelatorio(){
       var url = '/consultas/relatorio/2/' +
         $('#date_mes').val() + "/" +  $('#date_ano').val() + ".pdf";
       
        window.location = url;
    }
    
    function filtrar(){
       var url = '/consultas/list/2/' +
         $('#date_mes').val() + "/" +  $('#date_ano').val();
       
        window.location = url;
    }
</script>

<%= render '/layouts/filtro' %>

<div>
    <%= label :ano, "Ano" %>
    <%= select_year (Date.today, :field_name => 'ano', :start_year => 2010, :end_year => Date.current.year) %>
    <br>
    <%= label :mes, "M" %>&ecirc;s
    <%= select_month(Date.today, :field_name => 'mes', :use_month_numbers => true) %>
</div>
<br> 
<a href="#" onclick="filtrar()">Filtrar por m&ecirc;s/ano</a>
<br>
<a href="#" onclick="gerarRelatorio()">Gerar Relat&oacute;rio Mensal</a>

<table id="box-table-a" class="advancedtable">
  <tr>
    <thead>
      <th>Data</th>
      <th>Uf</th>
      <th>Solicitante</th>
      <th>Departamento</th>
      <th>Resposta</th>
      <th>Carga horaria</th>
      <th colspan="3" style="text-align:center">Opera&ccedil;&otilde;es</th>
    </thead>
  </tr>

<% @demandas.each do |demanda| %>
  <tr>
    <td><%= demanda.data.strftime("%m/%d/%Y") %></td>
    <td><%= demanda.uf %></td>
    <td><%= demanda.solicitante %></td>
    <td><%= demanda.departamento %></td>
    <td><%= demanda.resposta.strftime("%m/%d/%Y") %></td>
    <td><%= demanda.carga_horaria %></td>
    <td><%= link_to 'Visualizar', demanda %></td>
    <td><%= link_to "Editar", :controller => "demandas", :action => "edit_levantamento", :id => demanda.id %></td>
    <td><%= link_to 'Excluir', demanda, :method => :delete, :data => { :confirm => 'Are you sure?' } %></td>
  </tr>
<% end %>
</table>

<br />

<%= link_to 'Novo Levantamento', "/levantamentos/new" %>
